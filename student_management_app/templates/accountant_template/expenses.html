{% extends 'accountant_template/base_template.html' %} {% block page_title %} 
Expenses Details 
{% endblock page_title %} {% block main_content %} {% load static %}

<section class="content">
  <div class="container-fluid">
    <div class="row">
        <div class="col-lg-4 col-6">
            <!-- small box -->
            <div class="small-box bg-success">
              <div class="inner">
                <h3 class="h3-hide">{{ totalpaidlist }}</h3>
                <h3 class="h3-show" id="totalpaidlist"></h3>

                <p>Total Paid To Teachers</p>
              </div>
              <div class="icon">
                <i class="ion ion-stats-bars"></i>
              </div>
              <a href="#" class="small-box-footer"></a>
            </div>
          </div>
          <div class="col-lg-4 col-6">
            <!-- small box -->
            <div class="small-box bg-info">
              <div class="inner">
                 
                  <h3 class="h3-hide">{{ totalobtainedlist }}</h3>
                  <h3 class="h3-show" id="totalobtainedlist"></h3>
                  
                  
                  
                <p>Total Recieved From Students</p>
              </div>
              <div class="icon">
                <i class="ion ion-stats-bars"></i>
              </div>
              <a href="#" class="small-box-footer"></a>
            </div>
          </div> 
          <div class="col-lg-4 col-6">
            <!-- small box -->
            <div class="small-box bg-danger">
              <div class="inner">
                <h3 class="h3-hide">{{ totalAElist }}</h3>
                <h3 class="h3-show" id="totalAElist"></h3>

                <p>Total Additional Expenses</p>
              </div>
              <div class="icon">
                <i class="ion ion-stats-bars"></i>
              </div>
              <a href="#" class="small-box-footer"></a>
            </div>
          </div>
          <div class="col-lg-6 col-6">
            <!-- small box -->
            <div class="small-box bg-warning">
              <div class="inner">
                <h3 class="h3-hide">{{ totalexpenses }}</h3>
                <h3 class="h3-show" id="totalexpenses"></h3>

                <p>Total Expenses</p>
              </div>
              <div class="icon">
                <i class="ion ion-stats-bars"></i>
              </div>
              <a href="#" class="small-box-footer"></a>
            </div>
          </div>
          <div class="col-lg-6 col-6">
            <!-- small box -->
            <div class="small-box bg-primary">
              <div class="inner">
                <h3 class="h3-hide" >{{ totalprofit }}</h3>
                <h3 class="h3-show" id="totalprofit"></h3>

                <p>Total Profit</p>
              </div>
              <div class="icon">
                <i class="ion ion-stats-bars"></i>
              </div>
              <a href="#" class="small-box-footer"></a>
            </div>
          </div>

          
        
    </div>
    
    <div class="row first-one">
        
      <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Expenses Details</h3>
            </div>


            <div class="card-body">
                <div class="row">
                    <div class="col-lg-4">
                        <div class="form-group">
                            <label>Start Date <span class="badge badge-primary" id="bttnToday">Today</span>
                            </label>
                            <input type="date" id="inputVal" class="form-control" name="start_date" />
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="form-group">
                            <label>End Date<span class="badge badge-primary" id="bttn2Today">Today</span>
                            </label>
                            <input type="date" id="inputVal2" class="form-control" name="end_date" />
                        </div>
                    </div>

                </div>
                
            </div><!-- card-body -->
                <div class="card-footer">
                    <div class="row">
                        <div class="form-group">
                            <button type="button" class="btn btn-outline-primary ml-1 " id="fetch_details">Fetch Details</button>
                            <button type="button" class="btn btn-primary reply_open_modal" data-toggle="modal" data-target="#replyModal" id="add_payment">Add Additional Expense</button>
                        </div>
                    </div>
                </div>
            <div class="card-body">
                
                
                <div class="row">
                    <div class="col-lg-6">
                        <div class="table-responsive">
                            <table class="table">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>ID</th>
                                        <th>Teacher</th>
                                        <th>Paid Upto</th>
                                        <th>Payment Amount</th>
                                    </tr>
                                </thead>
                                <tbody class="table-hide">
                                    {% for pt in paymentTeacher %}
                                    <tr>
                                        <td>{{forloop.counter}}</td>
                                        <td>{{pt.teacher_id.admin.first_name}} {{pt.teacher_id.admin.last_name}}</td>
                                        <td>{{pt.payment_upto}}</td>
                                        <td>{{pt.payment_amount}}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                <tbody class="table-show" id="table-show-1">

                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="table-responsive">
                            <table class="table">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>ID</th>
                                        <th>Student</th>
                                        <th>Payment of</th>
                                        <th>Fees</th>
                                    </tr>
                                </thead>
                                <tbody  class="table-hide">
                                    {% for ps in paymentStudent %}
                                    <tr>
                                        <td>{{forloop.counter}}</td>
                                        <td>{{ps.student_id.admin.first_name}} {{ps.student_id.admin.last_name}}</td>
                                        <td>{{ps.fees_title}}</td>
                                        <td>{{ps.amount}}</td>
                                        
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                <tbody class="table-show" id="table-show-2">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="table-responsive my-5">
                            <table class="table">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>ID</th>
                                        <th>Title</th>
                                        <th>Date</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody class="table-hide">
                                    {% for ae in additionalExpenses %}
                                    <tr>
                                        <td>{{forloop.counter}}</td>
                                        <td>{{ae.title}}</td>
                                        <td>{{ae.date}}</td>
                                        <td>{{ae.amount}}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                <tbody class="table-show" id="table-show-3">

                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                </div>

            </div>
            


        </div><!-- card -->
      </div><!-- col-md-12 -->
    </div> <!-- row first-one -->
  </div><!-- /.container-fluid -->
</section>
{% comment %} Modal to Reply Feedback {% endcomment %}
<!-- Modal -->
<div class="modal fade" id="replyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Expense</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Title : </p>
                <input type="text" class="form-control" id="expenseTitle" name="expenseTitle" />
                <p>Date : </p>
                <input type="date" class="form-control" id="expenseDate" name="expenseDate" />
                <p>Expense Amount : </p>
                <input type="number" class="form-control" id="expenseAmount" name="expenseAmount" />
            </div>
            <div class="modal-footer">
                {% comment %} <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> {%endcomment %}
                <button type="button" class="btn btn-primary btn-block" id="reply_button"><i class="nav-icon fas fa-plus"></i> Add</button>
            </div>
        </div>
    </div>
</div>

{% endblock main_content %} {% block custom_js %}

<script>
  $(document).ready(function () {
    $(document).on("click", "#reply_button", function(){
                //Disabling the Button while data is being saved in Server
                $(this).attr("disabled", "disabled")
                $(this).text("Saving ...")

                //console.log("SAVE")
                

                var expenseTitle=$("#expenseTitle").val();
                var expenseDate=$("#expenseDate").val();
                var expenseAmount=$("#expenseAmount").val();
                //console.log(student_data);

                // Saving Attendance Data into Database

                $.ajax({
                    url:"{% url 'accountant_add_expenses' %}",
                    type:'POST',
                    data:{ expenseAmount:expenseAmount , expenseDate:expenseDate , expenseTitle:expenseTitle},
                })

                
                .done(function(response){
                    
                    if(response=="True")
                    {
                        alert("Expense Saved!")
                    }
                    else
                    {
                        alert("Failed to Save Expense!")
                    }
                    location.reload()
                    
                    //console.log(response)
                })

                .fail(function(){
                    alert("Error in Saving Expense!.")
                })

            })

            $(".table-show").hide();
            
            $(".h3-show").hide();
            $("#fetch_details").click(function(){
                
                let start_date = $("#inputVal").val()
                let end_date = $("#inputVal2").val()
                
                
                let output="";
                let output2="";
                let output3="";

                $.ajax({
                    url:"{% url 'accountant_get_expenses' %}",
                    type:'POST',
                    data:{start_date:start_date , end_date:end_date},
                    dataType: "json",

                    success: function(data){
                        $(".table-show").show();
                        $(".table-hide").hide();
                        $(".h3-hide").hide();
                        $(".h3-show").show();
                        
                        
                        if(data.status == "OK"){
                            
                            let paymentTeacherList = data.paymentTeacherList;
                            let ptList = data.ptList;
                            let stList = data.stList;
                            let paymentStudentList = data.paymentStudentList;
                            let expensesList = data.expensesList;
                            // let totalpaidlist = data.totalpaidlist;

                                for(i=0;i<paymentTeacherList.length; i++){
                                    
                                    output += "<tr><td>"+ parseInt(i+1) +"</td><td>"+ptList[i]+"</td><td>"+paymentTeacherList[i].payment_upto+"</td><td>"+paymentTeacherList[i].payment_amount+"</td></tr>";

                                }

                                for (i=0;i<paymentStudentList.length;i++){
                                    output2 += "<tr><td>"+ parseInt(i+1) +"</td><td>"+stList[i]+"</td><td>"+paymentStudentList[i].pay_upto+"</td><td>"+paymentStudentList[i].amount+"</td></tr>";
                                }

                                for(i=0;i<expensesList.length;i++){
                                    output3 += "<tr><td>"+ parseInt(i+1) +"</td><td>"+expensesList[i].title+"</td><td>"+expensesList[i].date+"</td><td>"+expensesList[i].amount+"</td></tr>";
                                }
                        }
                            
                            
                            $("#table-show-1").html(output);
                            $("#table-show-2").html(output2);
                            $("#table-show-3").html(output3);
                            $('#totalpaidlist').html(data.totalpaidlist);
                            $('#totalobtainedlist').html(data.totalobtainedlist);
                            $('#totalAElist').html(data.totalAElist);
                            $('#totalexpenses').html(data.totalexpenses);
                            $('#totalprofit').html(data.totalprofit);
                            
                            
                            

                            console.log(data.totalpaidlist)
                            
                            // console.log(data.paymentTeacherList);
                            


                        },
                        

                    
                
                });

                    
                    
                

            });
    
  });
</script>

{% endblock custom_js %}
